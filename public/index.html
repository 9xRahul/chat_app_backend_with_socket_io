<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Chat App Backend — API Documentation</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --page-bg: #f6f8fb;
            --text: #0f172a;
            --muted: #6b7280;
            --accent: #2563eb;
            --code-bg: #0f172a;
            --code-text: #e6eef8;
            --max-width: 1100px;
            --gap: 18px;
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            height: 100%;
            margin: 0;
            font-family: Inter, system-ui, Segoe UI, Roboto, Helvetica, Arial;
            background: var(--page-bg);
            color: var(--text)
        }

        .wrap {
            max-width: var(--max-width);
            margin: 28px auto;
            padding: 18px
        }

        header {
            margin-bottom: 12px
        }

        h1 {
            margin: 0 0 6px;
            font-size: 22px;
            color: var(--accent)
        }

        p.lead {
            margin: 0 0 12px;
            color: var(--muted)
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: var(--gap)
        }

        @media (max-width:900px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        section {
            margin-bottom: 14px
        }

        h2 {
            margin: 10px 0 8px;
            font-size: 16px
        }

        .method {
            display: inline-block;
            padding: 5px 8px;
            border-radius: 6px;
            font-weight: 700;
            margin-right: 8px;
            font-size: 13px;
            background: #e6f2ff;
            color: #0b4a8a
        }

        .small {
            font-size: 13px;
            color: var(--muted)
        }

        .muted {
            color: var(--muted)
        }

        .inline-code {
            background: #eef2ff;
            padding: 3px 6px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 13px
        }

        /* Code blocks */
        pre {
            background: var(--code-bg);
            color: var(--code-text);
            padding: 12px;
            border-radius: 8px;
            font-size: 13px;
            overflow: auto;
            white-space: pre-wrap;
            word-break: break-word;
            max-height: 360px
        }

        pre.example {
            cursor: copy
        }

        code {
            background: #eef2ff;
            padding: 2px 6px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 13px;
            color: var(--text)
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 8px;
            font-size: 13px
        }

        th,
        td {
            padding: 8px;
            border-bottom: 1px solid rgba(15, 23, 42, 0.04);
            vertical-align: top;
            text-align: left
        }

        th {
            color: var(--accent);
            font-weight: 600
        }

        td {
            word-wrap: break-word;
            max-width: 320px
        }

        .list-inline {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 8px 0
        }

        footer {
            margin-top: 18px;
            color: var(--muted);
            font-size: 13px
        }

        /* small helpers */
        .example-row {
            margin: 8px 0
        }

        .note {
            margin-top: 8px;
            color: var(--muted);
            font-size: 13px
        }
    </style>
</head>

<body>
    <div class="wrap">
        <header>
            <h1>Chat App Backend — API Documentation</h1>
            <p class="lead">REST + Socket.IO endpoints for the Flutter chat application. Replace <code
                    class="inline-code">&lt;BASE&gt;</code> with your server base URL (e.g. <code
                    class="inline-code">https://chat-app-backend-with-socket-io.onrender.com</code>).</p>
        </header>

        <div class="grid">
            <!-- main column -->
            <div>

                <section>
                    <h2>Authentication</h2>

                    <div class="example-row">
                        <span class="method">POST</span> <strong>/api/auth/register</strong>
                        <div class="small">Create a new user</div>
                        <pre class="example">Request JSON
{
  "name": "Alice",
  "email": "alice@example.com",
  "password": "password123"
}

Response 200
{
  "token": "&lt;JWT_TOKEN&gt;",
  "user": { "id": "&lt;userId&gt;", "name": "Alice", "email":"alice@example.com" }
}</pre>
                    </div>

                    <div class="example-row">
                        <span class="method">POST</span> <strong>/api/auth/login</strong>
                        <div class="small">Login and receive JWT</div>
                        <pre class="example">Request JSON
{
  "email": "alice@example.com",
  "password": "password123"
}

Response 200
{
  "token": "&lt;JWT_TOKEN&gt;",
  "user": { "id": "&lt;userId&gt;", "name": "Alice", "email":"alice@example.com" }
}</pre>
                    </div>

                    <div class="note">Use the returned <code class="inline-code">token</code> in Authorization header
                        (<code>Bearer &lt;token&gt;</code>) and as Socket.IO auth: <code>auth: { token }</code>.</div>
                </section>

                <section>
                    <h2>Users</h2>

                    <div class="example-row">
                        <span class="method">GET</span> <strong>/api/users/me</strong>
                        <div class="small">Get the current authenticated user</div>
                        <pre class="example">Headers
Authorization: Bearer &lt;TOKEN&gt;

Response 200
{
  "user": { "id":"&lt;id&gt;", "name":"Alice", "email":"alice@example.com", "online": true }
}</pre>
                    </div>

                    <div class="example-row">
                        <span class="method">GET</span> <strong>/api/users</strong>
                        <div class="small">List users (other than the logged-in user). Supports pagination and search.
                        </div>
                        <pre class="example">Query params
?q=&limit=20&page=1

Headers
Authorization: Bearer &lt;TOKEN&gt;

Response 200
{
  "users": [
    { "_id":"&lt;bob_id&gt;", "name":"Bob", "email":"bob@example.com", "online": false }
  ],
  "meta": { "total": 1, "page": 1, "limit": 20, "pages": 1 }
}</pre>
                    </div>

                </section>

                <section>
                    <h2>Messages</h2>

                    <div class="example-row">
                        <span class="method">POST</span> <strong>/api/messages</strong>
                        <div class="small">Send a message (REST). Server saves and emits to recipient if online.</div>
                        <pre class="example">Headers
Authorization: Bearer &lt;TOKEN&gt;

Body JSON
{
  "to": "&lt;recipient_user_id&gt;",
  "text": "Hello Bob!"
}

Response 200
{
  "message": {
    "_id": "&lt;messageId&gt;",
    "from": "&lt;senderId&gt;",
    "to": "&lt;recipientId&gt;",
    "text": "Hello Bob!",
    "createdAt": "2025-09-14T..."
  }
}</pre>
                    </div>

                    <div class="example-row">
                        <span class="method">GET</span> <strong>/api/messages/conversation/:userId</strong>
                        <div class="small">Get conversation with a user. Use <code class="inline-code">limit</code> and
                            <code class="inline-code">before</code> (ISO) for pagination. Returns messages ordered
                            oldest → newest.</div>
                        <pre class="example">GET /api/messages/conversation/68c6bbd86b1d1098da88a585?limit=20
Headers: Authorization: Bearer &lt;TOKEN&gt;

Response 200
{
  "messages": [
    { "_id":"&lt;id&gt;", "from":{ "_id":"...", "name":"Alice" }, "to":{...}, "text":"...", "createdAt":"..." }
  ]
}

Load older:
GET /api/messages/conversation/:userId?limit=20&before=2025-09-14T12:34:56.000Z
</pre>
                    </div>

                    <div class="note">UI pattern: load latest page first (no <code class="inline-code">before</code>),
                        on scroll up use earliest message <code>createdAt</code> as the <code>before</code> cursor and
                        prepend older messages.</div>
                </section>

            </div>

            <!-- side column -->
            <aside>
                <section>
                    <h2>Socket.IO (Realtime)</h2>
                    <div class="small">Connect using Socket.IO client and pass the token in the handshake <code
                            class="inline-code">auth</code> object.</div>

                    <pre class="example">// Browser or Node (socket.io-client)
const socket = io('&lt;BASE&gt;', {
  transports: ['websocket'],
  auth: { token: 'YOUR_JWT_TOKEN' }
});

socket.on('connect', () => console.log('connected', socket.id));
socket.on('connect_error', (err) => console.error('connect_error', err));
socket.on('private_message', (data) => console.log('private_message', data));
socket.on('user_online', (d) => console.log('user_online', d));</pre>

                    <h3 class="small">Events</h3>
                    <table>
                        <tr>
                            <th>Event</th>
                            <th>Dir</th>
                            <th>Payload</th>
                        </tr>
                        <tr>
                            <td><strong>private_message</strong></td>
                            <td>client → server</td>
                            <td>
                                <pre>{ "to":"&lt;userId&gt;","text":"hi" }</pre>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>private_message</strong></td>
                            <td>server → client</td>
                            <td>
                                <pre>{ "message": { "_id","from","to","text","createdAt" } }</pre>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>typing</strong></td>
                            <td>client → server</td>
                            <td>
                                <pre>{ "to":"&lt;userId&gt;","typing": true }</pre>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>user_online</strong></td>
                            <td>server → client</td>
                            <td>
                                <pre>{ "userId":"&lt;id&gt;","online": true }</pre>
                            </td>
                        </tr>
                    </table>

                    <div class="note">If you see <code class="inline-code">connect_error Authentication error</code>,
                        re-login and use the returned token.</div>
                </section>

                <section>
                    <h2>Schemas</h2>
                    <div class="small">Message</div>
                    <pre class="example">{
  "_id":"68c6d11d7fb975b1ed333d2f",
  "from":"68c6bbd86b1d1098da88a585",
  "to":"68c6bbd86b1d1098da88a585",
  "text":"Hello",
  "createdAt":"2025-09-14T14:28:45.108Z",
  "delivered":false,
  "seen":false
}</pre>

                    <div class="small">User</div>
                    <pre class="example">{
  "_id":"68c6bbd86b1d1098da88a585",
  "name":"Alice",
  "email":"alice@example.com",
  "online":true,
  "socketId":"j_xwLQ4WdSQaq_70AAAB",
  "socketIds":["j_xw..."],
  "createdAt":"...",
  "updatedAt":"..."
}</pre>
                </section>

                <section>
                    <h2>Quick curl</h2>
                    <div class="small">Login</div>
                    <pre class="example">curl -s -X POST "&lt;BASE&gt;/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"email":"alice@example.com","password":"12345678"}'</pre>

                    <div class="small">Send</div>
                    <pre class="example">curl -X POST "&lt;BASE&gt;/api/messages" \
  -H "Authorization: Bearer &lt;TOKEN&gt;" \
  -H "Content-Type: application/json" \
  -d '{"to":"&lt;USER_ID&gt;","text":"hello"}'</pre>
                </section>

                <section>
                    <h2>Deployment & env</h2>
                    <div class="small">Required env vars: <code class="inline-code">MONGO_URI</code>, <code
                            class="inline-code">JWT_SECRET</code>, <code class="inline-code">FRONTEND_ORIGIN</code>,
                        <code class="inline-code">NODE_ENV</code>.</div>
                    <div class="note">Render: set env vars on the dashboard and push repo. Socket.IO works over
                        wss/https on Render.</div>
                </section>
            </aside>
        </div>

        <footer>
            <div class="small">This documentation page is served by the backend. Replace <code
                    class="inline-code">&lt;BASE&gt;</code> with your base URL. Remove or protect this page before
                exposing to the public if needed.</div>
        </footer>
    </div>

    <script>
        // click-to-copy for pre blocks
        document.querySelectorAll('pre.example').forEach(pre => {
            pre.addEventListener('click', () => {
                const t = pre.innerText;
                if (!navigator.clipboard) return;
                navigator.clipboard.writeText(t).then(() => {
                    pre.style.outline = '2px solid rgba(37,99,235,0.12)';
                    setTimeout(() => pre.style.outline = '', 600);
                }).catch(() => { });
            });
        });
    </script>
</body>

</html>